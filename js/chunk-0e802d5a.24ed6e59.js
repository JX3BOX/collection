(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0e802d5a"],{"0837":function(t,e,n){"use strict";n("b9c79")},"084d":function(t,e,n){},"0b4e":function(t,e,n){"use strict";n("e7d2")},1829:function(t,e,n){"use strict";n("5644")},"4f1d":function(t,e,n){"use strict";n("eb09")},5644:function(t,e,n){},8366:function(t,e,n){"use strict";n("b07e")},ae14:function(t,e,n){"use strict";n("c2ee")},b07e:function(t,e,n){},b9c79:function(t,e,n){},c0ba:function(t,e,n){"use strict";n("084d")},c106:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"m-search-bar",class:"view"==t.$route.name?"can-return":""},[n("div",{staticClass:"m-return"},[n("el-button",{staticClass:"u-return-btn",on:{click:t.return_handle}},[t._v("返回 ")])],1),n("div",{staticClass:"m-search"},[n("el-input",{staticClass:"u-search-input",attrs:{placeholder:"输入剑三小册标题「回车」进行搜索"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search_handle(e)}},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}},[n("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("关键词")])]),n("el-button",{staticClass:"u-search-btn",attrs:{type:"primary",plain:""},on:{click:t.search_handle}},[t._v("搜索 ")])],1)])},i=[],s={name:"Search",data:function(){return{keyword:""}},methods:{return_handle:function(){history.back()},search_handle:function(){var t={};this.$store.state.sidebar.tag&&(t.tag=this.$store.state.sidebar.tag),this.$router.push({name:"normal",params:t,query:{keyword:this.keyword,page:1}})}}},o=s,r=(n("4f1d"),n("2877")),l=Object(r["a"])(o,a,i,!1,null,null,null);e["a"]=l.exports},c2ee:function(t,e,n){},c84b:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-collection-detail"},[n("Search"),t.collection?[n("div",{staticClass:"m-collection-detail-content"},[n("div",{staticClass:"m-collection-detail-header"},[n("header",{staticClass:"m-single-header"},[n("div",{staticClass:"m-single-title"},[n("a",{staticClass:"u-title u-sub-block",attrs:{href:t.url,title:t.collection.title}},[t.collection.public?t._e():n("svg",{class:"u-private",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 16",width:"12",height:"16",fill:"#dbab09","svg-inline":"",title:"仅自己可见",role:"presentation",focusable:"false",tabindex:"-1"}},[n("path",{attrs:{"fill-rule":"evenodd",d:"M4 13H3v-1h1v1zm8-6v7c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V7c0-.55.45-1 1-1h1V4c0-2.2 1.8-4 4-4s4 1.8 4 4v2h1c.55 0 1 .45 1 1zM3.8 6h4.41V4c0-1.22-.98-2.2-2.2-2.2-1.22 0-2.2.98-2.2 2.2v2H3.8zM11 7H2v7h9V7zM4 8H3v1h1V8zm0 2H3v1h1v-1z"}})]),n("span",{staticClass:"u-title-text"},[t._v(t._s(t.collection.title))])])]),n("div",{staticClass:"m-single-info"},[n("span",{staticClass:"u-id u-sub-block"},[n("span",{staticClass:"u-id-label"},[t._v("小册ID")]),n("span",{staticClass:"u-id-value"},[t._v(t._s(t.collection.id))])]),n("div",{staticClass:"u-author u-sub-block"},[n("i",{staticClass:"u-author-icon"},[n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 16",width:"12",height:"16","aria-hidden":"true",fill:"#444","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[n("path",{attrs:{"fill-rule":"evenodd",d:"M12 14.002a.998.998 0 01-.998.998H1.001A1 1 0 010 13.999V13c0-2.633 4-4 4-4s.229-.409 0-1c-.841-.62-.944-1.59-1-4 .173-2.413 1.867-3 3-3s2.827.586 3 3c-.056 2.41-.159 3.38-1 4-.229.59 0 1 0 1s4 1.367 4 4v1.002z"}})])]),n("a",{staticClass:"u-name",attrs:{href:t._f("authorLink")(t.collection.user_id)}},[t._v(t._s(t.collection.user_nickname))])]),n("span",{staticClass:"u-podate u-sub-block",attrs:{title:"发布日期"}},[n("i",{staticClass:"u-icon-podate"},[n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"#6a737d",viewBox:"0 0 485.2 485.2","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[n("path",{attrs:{d:"M60.7 75.8V15.2C60.7 6.8 67.4 0 75.8 0 84.2 0 91 6.8 91 15.2v60.7C91 84.2 84.2 91 75.8 91c-8.4 0-15.1-6.8-15.1-15.2zM318.4 91c8.4 0 15.2-6.8 15.2-15.2V15.2c0-8.4-6.8-15.2-15.2-15.2-8.4 0-15.2 6.8-15.2 15.2v60.7c.1 8.3 6.8 15.1 15.2 15.1zM60.7 182h60.7v60.7H60.7zM60.7 272.9h60.7v60.7H60.7zM151.6 182h60.7v60.7h-60.7zM151.6 272.9h60.7v60.7h-60.7z"}}),n("path",{attrs:{d:"M30 361.2v-210h334c.2 70.7.4 141.4.7 212.1 9.8 0 19.6-.1 29.3-.1V93.6c0-18.5-14.5-33.4-32.5-33.4H349v15.2c0 16.7-13.7 30.3-30.5 30.3S288 92.1 288 75.4V60.2H106v15.2c0 16.7-13.7 30.3-30.5 30.3S45 92.1 45 75.4V60.2H32.5c-18 0-32.5 15-32.5 33.4v267.2c0 9.2 3.6 17.5 9.5 23.6 7.8 8.1 18.5 9.3 23 9.8 22.1 2.4 165.3 2.9 361.5 1v-32c-120.5.3-241 .7-361.5 1-.8-1-1.7-2-2.5-3z"}}),n("path",{attrs:{d:"M242.6 182h60.6v60.7h-60.6zM242.6 272.9h60.7v60.7h-60.7z"}})])]),n("time",[t._v(t._s(t.date_format(t.collection.created)))])]),n("span",{staticClass:"u-modate u-sub-block",attrs:{title:"最后更新"}},[n("i",{staticClass:"u-icon-modate"},[n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"485.213",height:"485.212",viewBox:"0 0 485.213 485.212",fill:"#555","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[n("path",{attrs:{d:"M60.652 75.816V15.163C60.652 6.781 67.433 0 75.817 0c8.38 0 15.161 6.781 15.161 15.163v60.653c0 8.38-6.781 15.161-15.161 15.161-8.384.001-15.165-6.781-15.165-15.161zm257.772 15.162c8.378 0 15.163-6.781 15.163-15.161V15.163C333.587 6.781 326.802 0 318.424 0c-8.382 0-15.168 6.781-15.168 15.163v60.653c0 8.38 6.786 15.162 15.168 15.162zm166.788 272.928c0 66.996-54.312 121.307-121.303 121.307-66.986 0-121.302-54.311-121.302-121.307 0-66.986 54.315-121.3 121.302-121.3 66.991 0 121.303 54.313 121.303 121.3zm-30.322 0c0-50.161-40.81-90.976-90.98-90.976-50.166 0-90.976 40.814-90.976 90.976 0 50.171 40.81 90.98 90.976 90.98 50.17 0 90.98-40.809 90.98-90.98zM121.305 181.955H60.652v60.651h60.653v-60.651zM60.652 333.584h60.653V272.93H60.652v60.654zm90.977-90.978h60.654v-60.651h-60.654v60.651zm0 90.978h60.654V272.93h-60.654v60.654zM30.328 360.891V151.628H363.91v60.653h30.327V94c0-18.421-14.692-33.349-32.843-33.349h-12.647v15.166c0 16.701-13.596 30.325-30.322 30.325-16.731 0-30.326-13.624-30.326-30.325V60.651H106.14v15.166c0 16.701-13.593 30.325-30.322 30.325-16.733 0-30.327-13.624-30.327-30.325V60.651H32.859C14.707 60.651.001 75.579.001 94v266.892c0 18.36 14.706 33.346 32.858 33.346h179.424v-30.331H32.859c-1.374-.001-2.531-1.42-2.531-3.016zm272.928-118.285v-60.651h-60.648v60.651h60.648zm106.143 121.3h-45.49v-45.49c0-8.377-6.781-15.158-15.163-15.158s-15.159 6.781-15.159 15.158v60.658c0 8.378 6.777 15.163 15.159 15.163h60.653c8.382 0 15.163-6.785 15.163-15.163 0-8.382-6.781-15.168-15.163-15.168z"}})])]),n("time",[t._v(t._s(t.date_format(t.collection.updated)))])]),n("span",{staticClass:"u-views u-sub-block"},[n("i",{staticClass:"el-icon-view"}),t._v(" "+t._s(t.views)+" ")]),t.canEdit?n("a",{staticClass:"u-edit u-sub-block",attrs:{href:t.edit_link}},[n("i",{staticClass:"u-icon-edit el-icon-edit-outline"}),n("span",[t._v("编辑")])]):t._e(),t.canEdit?n("a",{staticClass:"u-delete u-sub-block",attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.delete_handle(e,t.collection.id)}}},[n("i",{staticClass:"u-icon-remove el-icon-delete"}),n("span",[t._v("删除")])]):t._e()])]),n("div",{staticClass:"m-collection-detail-panel"},[n("Fav",{staticClass:"u-fav",attrs:{"post-type":"collection","post-id":t.collection.id}}),n("Like",{staticClass:"u-like",attrs:{"post-type":"collection","post-id":t.collection.id}})],1)]),t.collection.description?[n("el-divider",{attrs:{"content-position":"left"}},[n("i",{staticClass:"el-icon-collection"}),t._v(" 小册简介 ")]),n("div",{staticClass:"u-description"},[n("p",{domProps:{innerHTML:t._s(t.collection.description)}})])]:t._e(),t.collection.posts&&t.collection.posts.length?[n("el-divider",{attrs:{"content-position":"left"}},[n("i",{staticClass:"el-icon-folder"}),t._v(" 小册文章 ")]),n("ul",{staticClass:"u-list"},t._l(t.collection.posts,(function(e,a){return n("li",{key:a,staticClass:"u-item"},[n("span",{staticClass:"u-item-order"},[t._v(t._s(a+1)+". ")]),"custom"===e.type?n("span",{staticClass:"u-item-link"},[n("i",{staticClass:"el-icon-link"}),t._v("站外链接 ")]):t._e(),"custom"!==e.type&&e.user_id?n("a",{staticClass:"u-item-author",attrs:{target:"_blank",href:t._f("author_url")(e.user_id)}},[n("img",{staticClass:"u-avatar",attrs:{src:t.get_thumbnail(e.user_avatar,20,!0)}}),n("span",{staticClass:"u-nickname",domProps:{textContent:t._s(e.user_nickname)}}),n("span",{staticClass:"u-div"},[t._v("/")])]):t._e(),n("a",{staticClass:"u-item-title",attrs:{target:"_blank",href:"custom"===e.type?e.url:t.get_link(e.type,e.id)}},[t._v(" "+t._s(e.title)+" ")]),e.updated?n("time",{staticClass:"u-updated",domProps:{textContent:t._s("最后更新于 "+t.date_format(e.updated))}}):t._e()])})),0)]:t._e()],2),t.collection.tags&&t.collection.tags.length?n("div",{staticClass:"m-tags"},[n("div",{staticClass:"u-tags-title"},[n("i",{staticClass:"el-icon-price-tag"}),n("span",[t._v("标签")])]),n("ul",{staticClass:"u-tags"},t._l(t.collection.tags,(function(e,a){return n("li",{key:a,staticClass:"u-tag",domProps:{textContent:t._s(e)}})})),0)]):t._e(),t.id?n("div",{staticClass:"m-comments"},[n("el-divider",{attrs:{"content-position":"left"}},[n("span",{staticStyle:{color:"#999999"}},[n("i",{staticClass:"el-icon-chat-line-square"}),t._v(" 讨论 ")])]),n("jx3-comment",{attrs:{id:t.id,category:"collection"}})],1):t._e()]:n("el-alert",{attrs:{title:"该剑三小册不存在或已被删除",type:"info",center:"","show-icon":"",closable:!1}})],2)},i=[],s=(n("d3b7"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-container",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"c-comment"},[n("el-main",[n("CommentInputForm",{on:{submit:t.userSubmitInputForm}}),n("div",{staticClass:"c-comment-order"},[n("span",[t._v("排序模式：")]),n("el-switch",{on:{change:t.changeOrder},model:{value:t.isDesc,callback:function(e){t.isDesc=e},expression:"isDesc"}}),n("b",[t._v(t._s(t.isDesc?"最后靠前":"最早靠前"))])],1),t.isNormal?[t._l(t.commentList,(function(e){return n("div",{key:e.id,staticClass:"c-comment-list"},[n("Avatar",{attrs:{"user-avatar":t._f("showAvatar")(e.avatar),"user-href":t._f("profileLink")(e.userId),username:e.displayName,avatarFrame:e.user_avatar_frame,withFrame:!0}}),n("CommmentWithReply",{attrs:{"base-api":t.baseAPI,item:e,category:t.category,power:t.commentPower,"user-href":t._f("profileLink")(e.userId),username:e.displayName},on:{deteleComment:t.deteleComment}})],1)})),n("div",{staticClass:"c-comment-pages"},[t.commentList.length>5?n("CommentInputForm",{on:{submit:t.userSubmitInputForm}}):t._e(),n("div",{staticClass:"u-pages"},[n("el-pagination",{staticStyle:{"text-align":"right"},attrs:{background:"","hide-on-single-page":"","current-page":t.pager.index,"page-size":t.pager.pageSize,layout:"prev, pager, next, total",total:t.pager.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){return t.$set(t.pager,"index",e)},"update:current-page":function(e){return t.$set(t.pager,"index",e)}}})],1)],1)]:t._e()],2)],1)}),o=[],r=(n("99af"),n("85e4")),l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"c-comment-avatar"},[n("a",{staticClass:"u-avatar",attrs:{href:t.userHref,target:"_blank"}},[n("el-avatar",{staticClass:"u-avatar-pic",class:{isCircle:t.isCircle},attrs:{shape:"square",size:t.avatarSize,src:t.userAvatar}}),t.frameName?n("i",{staticClass:"u-avatar-frame"},[n("img",{attrs:{src:t.frameUrl}})]):t._e()],1),n("el-link",{staticClass:"u-name",attrs:{type:"primary",target:"_blank",href:t.userHref}},[t._v(t._s(t.username))])],1)},c=[],u=n("65c2"),m={props:["avatarSize","userAvatar","userHref","username","avatarFrame","withFrame"],data:function(){return{}},computed:{frames:function(){return this.$store.state.frames},frameName:function(){return this.avatarFrame&&this.frames[this.avatarFrame]?this.avatarFrame:""},frameUrl:function(){if(this.frameName){var t=this.frames[this.frameName].files.s.file;return u["__imgPath"]+"image/avatar/".concat(this.frameName,"/").concat(t)}return""},isCircle:function(){return this.frameName&&"circle"==this.frames[this.frameName].style}},methods:{},mounted:function(){}},d=m,p=(n("c0ba"),n("2877")),h=Object(p["a"])(d,l,c,!1,null,null,null),f=h.exports,v=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-form",{ref:"form",staticClass:"c-comment-box",attrs:{model:t.newComment}},[n("el-form-item",[n("el-input",{attrs:{rows:"3",type:"textarea",maxlength:"300","show-word-limit":"",placeholder:"参与讨论..."},model:{value:t.newComment.content,callback:function(e){t.$set(t.newComment,"content",e)},expression:"newComment.content"}}),t.showUploader?n("Uploader",{ref:"uploader",staticClass:"u-uploader",on:{onFinish:t.attachmentUploadFinish,onError:t.attachmentUplodError}}):t._e(),n("div",{staticClass:"u-toolbar"},[n("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-picture",size:"mini"},on:{click:function(e){t.showUploader=!t.showUploader}}},[t._v("图片")]),n("el-button",{staticClass:"u-publish",attrs:{type:"primary",disabled:t.disableSubmitBtn},on:{click:t.onSubmit}},[t._v("发表评论")])],1)],1)],1)},g=[],y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-upload",{ref:"upload",attrs:{action:"https://server.jx3box.com/upload","list-type":"picture-card","on-preview":t.handlePictureCardPreview,"auto-upload":!1,"file-list":t.fileList,limit:3,multiple:"","with-credentials":"","on-exceed":t.onExceed,"on-change":t.onChange,"on-success":t.onSuccess,"on-error":t.onError}},[n("i",{staticClass:"el-icon-plus"}),n("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(" 只能上传jpg/png/gif文件，且不超过500k的３张图片 ")])]),n("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[n("img",{attrs:{width:"60%",src:t.dialogImageUrl,alt:""}})])],1)},b=[],_={data:function(){return{dialogImageUrl:"",dialogVisible:!1,fileList:[],successList:[]}},methods:{handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},onExceed:function(){this.$notify({title:"",message:"文件超过数量!",type:"error",duration:3e3,position:"bottom-right"})},onChange:function(t,e){"ready"==t.status&&(t.size>512e3?(this.$notify({title:"",message:"图片大小不能超过500kb!",type:"error",duration:3e3,position:"bottom-right"}),e.pop()):this.fileList=e)},upload:function(){this.fileList.length>0?this.$refs.upload.submit():this.$emit("onFinish",[])},onSuccess:function(t){this.successList=this.successList.concat(t.data.list),this.successList.length==this.fileList.length&&(this.$emit("onFinish",this.successList||[]),this.fileList=[],this.successList=[])},onError:function(){this.$notify({title:"",message:"图片上传失败!",type:"error",duration:3e3,position:"bottom-right"}),this.$emit("onError"),this.fileList=[]}}},w=_,C=Object(p["a"])(w,y,b,!1,null,null,null),k=C.exports,x={components:{Uploader:k},data:function(){return{showUploader:!1,disableSubmitBtn:!1,newComment:{}}},methods:{onSubmit:function(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},attachmentUploadFinish:function(t){this.$emit("submit",{content:this.newComment.content,attachmentList:t}),this.newComment={},this.showUploader=!1,this.disableSubmitBtn=!1},attachmentUplodError:function(){this.disableSubmitBtn=!1}}},R=x,L=Object(p["a"])(R,v,g,!1,null,null,null),F=L.exports,$=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"c-comment-cmt"},[n("el-link",{staticClass:"u-name",attrs:{type:"primary",target:"_blank",href:t.userHref}},[t._v(t._s(t.username||"人字榜800线无名小侠"))]),n("CommentContent",{attrs:{date:t.item.commentDate,content:t.item.content,attachments:t._f("stringToArray")(t.item.attachments),"can-delete":t.power.allow||t.power.uid==t.item.userId},on:{addNewReply:t.addNewReply,deteleComment:t.deteleComment}}),n("ReplyList",{attrs:{data:t.replyList,pager:t.pager,power:t.power},on:{addNewReply:t.addNewReply,deleteReply:t.deleteReply,goto:t.gotoReplyListIndex,resetReply:t.resetReply}})],1)},I=[],U=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"u-cmt"},[""!=t.content?n("div",{staticClass:"u-text"},[t._v(t._s(t.content))]):t._e(),t.attachments.length?n("div",{staticClass:"u-attachements"},t._l(t.attachments,(function(e){return n("el-image",{key:e,attrs:{src:t._f("showAttachment")(e),"preview-src-list":t._attachments,lazy:""}})})),1):t._e(),n("div",{staticClass:"u-toolbar"},[n("el-button",{staticClass:"u-admin",attrs:{type:"text",size:"mini",icon:"el-icon-chat-round"},on:{click:function(e){t.showForm=!t.showForm}}},[t._v("回复")]),t.canDelete?n("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-delete",size:"mini"},on:{click:function(e){return t.deleteComment()}}},[t._v("删除")]):t._e(),n("time",{staticClass:"u-date"},[n("i",{staticClass:"el-icon-time"}),t._v(" "+t._s(t.dataFormat(t.date))+" ")])],1),t.showForm?n("el-form",{ref:"form",staticClass:"c-comment-subbox",attrs:{model:t.newComment}},[n("el-form-item",[n("el-input",{attrs:{type:"textarea"},model:{value:t.newComment.content,callback:function(e){t.$set(t.newComment,"content",e)},expression:"newComment.content"}}),n("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-picture",size:"mini"},on:{click:function(e){t.showUploader=!t.showUploader}}},[t._v("图片")])],1),n("el-form-item",[t.showUploader?n("Uploader",{ref:"uploader",on:{onFinish:t.attachmentUploadFinish,onError:t.attachmentUplodError}}):t._e()],1),n("el-form-item",[n("el-button",{attrs:{size:"mini",type:"primary",disabled:t.disableSubmitBtn},on:{click:function(e){return t.submit()}}},[t._v("提交")]),n("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){t.showForm=!1}}},[t._v("收起")])],1)],1):t._e()],1)},z=[];n("d81d");function O(t){return t>9?t:"0".concat(t)}var P={props:["content","date","hasReply","canDelete","attachments"],components:{Uploader:k},data:function(){return{newComment:{},showForm:!1,disableSubmitBtn:!1,showUploader:!1}},computed:{_attachments:function(){return this.attachments.map((function(t){return Object(r["resolveImagePath"])(t)}))}},methods:{deleteComment:function(){this.$emit("deteleComment")},dataFormat:function(t){var e=new Date(t);return e.getFullYear()+"-"+O(e.getMonth()+1)+"-"+O(e.getDate())+" "+O(e.getHours())+":"+O(e.getMinutes())+":"+O(e.getSeconds())},attachmentUploadFinish:function(t){this.disableSubmitBtn=!1,this.$emit("addNewReply",{content:this.newComment.content,attachmentList:t}),this.showUploader=!1,this.newComment={}},attachmentUplodError:function(){this.disableSubmitBtn=!1},submit:function(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},hideForm:function(){}},filters:{showAttachment:function(t){return Object(r["resolveImagePath"])(t)+"?x-oss-process=style/comment_thumb"}}},S=P,j=(n("e314"),Object(p["a"])(S,U,z,!1,null,null,null)),E=j.exports,A=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.data.length?n("div",{staticClass:"c-comment-replylist"},[t._l(t.data,(function(e){return n("reply-item",{key:e.id,staticClass:"c-comment-reply",attrs:{reply:e,power:t.power},on:{deleteReply:t.deleteReply,addReply:t.addReply}})})),n("el-row",[t.data.length>=3||t.showPager?n("el-col",{attrs:{span:1}},[n("el-button",{directives:[{name:"show",rawName:"v-show",value:t.showPager,expression:"showPager"}],attrs:{type:"text"},on:{click:function(e){return t.showLess()}}},[t._v("收起")]),n("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.showPager,expression:"!showPager"}],attrs:{type:"text"},on:{click:function(e){return t.showMore()}}},[t._v("查看更多")])],1):t._e(),n("el-col",{staticClass:"c-comment-reply-pages",attrs:{span:23}},[n("el-pagination",{directives:[{name:"show",rawName:"v-show",value:t.showPager,expression:"showPager"}],attrs:{small:"","current-page":t.pager.index,"page-size":t.pager.pageSize,layout:"total, prev, pager, next",total:t.pager.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){return t.$set(t.pager,"index",e)},"update:current-page":function(e){return t.$set(t.pager,"index",e)}}})],1)],1)],2):t._e()},N=[],D=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-row",[n("Avatar",{attrs:{"user-avatar":t._f("showAvatar")(t.reply.avatar),"user-href":t._f("profileLink")(t.reply.userId),username:t.reply.displayName}}),n("CommentContentSimple",{attrs:{"comment-id":t.reply.id,date:t.reply.commentDate,content:t.reply.content,attachments:t._f("stringToArray")(t.reply.attachments),"can-delete":t.power.allow||t.power.uid==t.reply.userId,"can-reply":t.power.uid!=t.reply.userId,"user-href":t._f("profileLink")(t.reply.replyForUID),"reply-for-username":t.reply.replyForUsername,"reply-for-user-id":t.reply.replyForUID},on:{delete:t.deleteReply,showReplyInput:function(e){t.showReplyForReplyFrom=!t.showReplyForReplyFrom}}}),t.showReplyForReplyFrom?n("ReplyForReply",{attrs:{username:t.reply.displayName,"user-href":t._f("profileLink")(t.reply.userId)},on:{hideForm:function(e){t.showReplyForReplyFrom=!1},doReply:t.doReply}}):t._e()],1)},H=[],B=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"u-reply"},[n("div",{staticClass:"u-reply-content"},[0!=t.replyForUserId?n("span",{staticClass:"u-reply-label"},[t._v(" 回复 "),n("el-link",{attrs:{type:"primary",target:"_blank",href:t.userHref}},[t._v("@"+t._s(t.replyForUsername))]),t._v(" : ")],1):t._e(),t._l(t.getPList(t.content),(function(e,a){return n("p",{key:a},[t._v(t._s(e))])}))],2),t.attachments.length?n("div",{staticClass:"u-attachements"},t._l(t.attachments,(function(e){return n("el-image",{key:e,attrs:{src:t._f("showAttachment")(e),"preview-src-list":t._attachments,lazy:""}})})),1):t._e(),n("div",{staticClass:"u-toolbar"},[t.canDelete?n("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-delete",size:"mini"},on:{click:function(e){return t.deleteComment()}}},[t._v("删除")]):t._e(),t.canReply?n("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-chat-line-round",size:"mini"},on:{click:function(e){return t.showReplyForReplyInput()}}},[t._v("回复")]):t._e(),n("time",{staticClass:"u-date"},[n("i",{staticClass:"el-icon-time"}),t._v(" "+t._s(t.dataFormat(t.date))+" ")])],1)])},T=[];n("ac1f"),n("1276");function M(t){return t>9?t:"0".concat(t)}var V={props:["commentId","content","attachments","date","hasReply","canDelete","canReply","userHref","replyForUsername","replyForUserId"],data:function(){return{showInput:!1}},computed:{_attachments:function(){return this.attachments.map((function(t){return Object(r["resolveImagePath"])(t)}))}},filters:{profileLink:function(t){return Object(r["authorLink"])(t)},showAttachment:function(t){return Object(r["resolveImagePath"])(t)+"?x-oss-process=style/comment_thumb"}},methods:{getPList:function(t){return t.split("\n")},deleteComment:function(){this.$emit("delete",this.commentId)},dataFormat:function(t){var e=new Date(t);return e.getFullYear()+"-"+M(e.getMonth()+1)+"-"+M(e.getDate())+" "+M(e.getHours())+":"+M(e.getMinutes())+":"+M(e.getSeconds())},showReplyForReplyInput:function(){this.$emit("showReplyInput")}}},J=V,X=(n("0b4e"),Object(p["a"])(J,B,T,!1,null,null,null)),q=X.exports,W=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-form",{ref:"form",staticClass:"c-comment-subbox"},[n("div",{staticClass:"u-subbox-label"},[t._v(" 回复 "),n("el-link",{attrs:{type:"primary",target:"_blank",href:t.userHref}},[t._v("＠"+t._s(t.username))]),t._v(" ： ")],1),n("el-form-item",[n("el-input",{attrs:{type:"textarea"},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}),n("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-picture",size:"mini"},on:{click:function(e){t.showUploader=!t.showUploader}}},[t._v("图片")])],1),n("el-form-item",[t.showUploader?n("Uploader",{ref:"uploader",on:{onFinish:t.attachmentUploadFinish,onError:t.attachmentUplodError}}):t._e()],1),n("el-form-item",[n("el-button",{attrs:{size:"mini",type:"primary",disabled:t.disableSubmitBtn},on:{click:function(e){return t.submintReply()}}},[t._v("提交")]),n("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){return t.hideForm()}}},[t._v("收起")])],1)],1)},Y=[],G={props:["username","userHref"],data:function(){return{content:"",showUploader:!1,disableSubmitBtn:!1}},components:{Uploader:k},methods:{submintReply:function(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},hideForm:function(){this.$emit("hideForm")},attachmentUploadFinish:function(t){this.disableSubmitBtn=!1,this.$emit("doReply",{content:this.content,attachmentList:t}),this.content="",this.showUploader=!1},attachmentUplodError:function(){this.disableSubmitBtn=!1}}},K=G,Q=(n("0837"),Object(p["a"])(K,W,Y,!1,null,null,null)),Z=Q.exports,tt={props:["reply","power"],components:{Avatar:f,CommentContentSimple:q,ReplyForReply:Z},backReplyList:[],data:function(){return{showReplyForReplyFrom:!1}},filters:{profileLink:function(t){return Object(r["authorLink"])(t)},stringToArray:function(t){return t?JSON.parse(t):[]},showAvatar:function(t){return Object(r["showAvatar"])(t,28)}},methods:{deleteReply:function(t){this.$emit("deleteReply",t)},doReply:function(t){t.replyForUID=this.reply.userId,t.replyForCommentId=this.reply.id,this.$emit("addReply",t),this.showReplyForReplyFrom=!1}}},et=tt,nt=Object(p["a"])(et,D,H,!1,null,null,null),at=nt.exports,it={props:["data","power","pager"],components:{ReplyItem:at},data:function(){return{showPager:!1}},filters:{profileLink:function(t){return Object(r["authorLink"])(t)}},methods:{showMore:function(){this.showPager=!0,this.$emit("goto",1)},showLess:function(){this.showPager=!1,this.$emit("resetReply")},handleCurrentChange:function(t){this.$emit("goto",t)},deleteReply:function(t){this.$emit("deleteReply",t)},addReply:function(t){this.$emit("addNewReply",t)}}},st=it,ot=(n("8366"),Object(p["a"])(st,A,N,!1,null,null,null)),rt=ot.exports,lt=n("ee8f"),ct=n("5c96");const ut=function(t,e){let n={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}};return ht(t,e,n)};var mt={};const dt=function(t,e,n){if(mt[t])if(Date.now()-mt[t].lastest<6e4){if(mt[t].count>=6)return ct["Notification"].warning({title:"系统",message:"你单身多久了? 动作这么快, 系统处理不过来 ( T_T )",duration:3e3,position:"bottom-right"}),new Promise((t,e)=>{e()});mt[t].count=mt[t].count+1}else Date.now()-mt[t].lastest>6e4&&(mt[t]={lastest:Date.now(),count:0});else mt[t]={lastest:Date.now(),count:0};let a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)};return ht(t,e,a)},pt=function(t,e){let n={method:"DELETE"};return ht(t,e,n)};function ht(t,e,n){let a=lt["JX3BOX"].__next;if("/"==a[a.length-1]&&(a=a.substring(0,a.length-1)),t=a+t,n.credentials="include",e){let n=[];Object.keys(e).forEach(t=>{n.push(t+"="+e[t])});let a=lt["JX3BOX"].__next;"/"==a[a.length-1]&&(a=a.substring(0,a.length-1)),t=t+"?"+n.join("&")}return fetch(t,n).then(t=>{switch(t.status){case 200:break;case 401:throw window.location.href=lt["JX3BOX"].__Links.account.login+"?redirect="+encodeURIComponent(window.location.href),new Error("错误:"+t.statusText);case 403:throw window.location.href=lt["JX3BOX"].__Links.account.login+"?redirect="+encodeURIComponent(window.location.href),new Error("错误:"+t.statusText);case 423:throw window.location.href=lt["JX3BOX"].__Links.account.email_verify+"?redirect="+encodeURIComponent(window.location.href),new Error("错误:"+t.statusText);case 406:throw t.text().then(t=>{ct["Notification"].warning({title:"系统",message:t||"提交内容不合法,请重新提交",duration:3e3,position:"bottom-right"})}),new Error("错误:"+t.statusText);default:throw t.text().then(e=>{ct["Notification"].error({title:"系统:"+t.statusText,message:e||"系统错误,请稍后重试!",duration:3e3,position:"bottom-right"})}),new Error("错误:"+t.statusText)}let e=t.headers.get("Content-Type");switch(e=e&&e.split(";").shift(),e){case"application/json":return t.json();default:return t.text()}})}var ft={props:["item","baseApi","power","user-href","username"],components:{CommentContent:E,ReplyList:rt},data:function(){return{replyList:[],pager:{index:1,pageSize:10,pageTotal:1,total:0}}},filters:{stringToArray:function(t){return t?JSON.parse(t):[]}},created:function(){this.replyList=this.item.reply||[]},methods:{deteleComment:function(){this.$emit("deteleComment",this.item.id)},addNewReply:function(t){var e=this;dt("".concat(this.baseApi,"/comment/").concat(this.item.id,"/reply"),null,t).then((function(){e.$notify({title:"",message:"评论成功!",type:"success",duration:3e3,position:"bottom-right"}),e.loadReplyList(e.pager.index)})).catch((function(){}))},deleteReply:function(t){var e=this;pt("".concat(this.baseApi,"/comment/").concat(t)).then((function(){e.$notify({title:"",message:"删除成功!",type:"success",duration:3e3,position:"bottom-right"}),e.loadReplyList(e.pager.index)})).catch((function(){}))},gotoReplyListIndex:function(t){this.loadReplyList(t,6)},loadReplyList:function(t,e){var n=this;ut("".concat(this.baseApi,"/comment/").concat(this.item.id,"/reply/page/").concat(t,"?pageSize=").concat(e)).then((function(a){1==t&&3==e&&(n.item.reply=a.data||[]),n.replyList=a.data||[],n.pager=a.page})).catch((function(){}))},resetReply:function(){this.loadReplyList(1,3)}}},vt=ft,gt=Object(p["a"])(vt,$,I,!1,null,null,null),yt=gt.exports,bt=n("bc3a"),_t=n.n(bt),wt=n("41cb"),Ct=n("c9d2");const kt="commentDefaultOrderMode";async function xt(){return Ct["a"].isLogin()?Object(wt["b"])().get("/api/cms/user/my/meta",{params:{key:kt}}).then(t=>t.data.data):new Promise(t=>{t(localStorage.getItem(kt))})}async function Rt(t){return Ct["a"].isLogin()?Object(wt["b"])().post("/api/cms/user/my/meta",{val:t},{params:{key:kt}}).then(t=>t.data.data):new Promise(e=>{e(localStorage.setItem(kt,t))})}var Lt={name:"Comment",props:["id","category","normal","order"],components:{Avatar:f,CommmentWithReply:yt,CommentInputForm:F},data:function(){return{baseAPI:"",commentPower:{allow:!1,uid:-1},commentList:[],pager:{index:1,pageSize:10,pageTotal:1,total:0},isDesc:"desc"==this.order,loading:!1}},computed:{isNormal:function(){return void 0===this.normal||this.normal}},methods:{changeOrder:function(){this.reloadCommentList(this.pager.index),Rt(this.isDesc?"desc":"asc")},deteleComment:function(t){var e=this;pt("".concat(this.baseAPI,"/comment/").concat(t)).then((function(){e.$notify({title:"",message:"删除成功!",type:"success",duration:3e3,position:"bottom-right"}),e.reloadCommentList(e.pager.index)})).catch((function(){}))},reloadCommentList:function(t){var e=this;this.loading=!0;var n={};this.isDesc&&(n["desc"]=!0),ut("".concat(this.baseAPI,"/comment/page/").concat(t),n).then((function(t){e.commentList=t.data||[],e.pager=t.page})).catch((function(){})).finally((function(){e.loading=!1}))},handleCurrentChange:function(t){this.reloadCommentList(t)},userSubmitInputForm:function(t){var e=this;dt("".concat(this.baseAPI,"/comment"),null,t).then((function(){e.$notify({title:"",message:"评论成功!",type:"success",duration:3e3,position:"bottom-right"}),1==e.pager.index&&e.reloadCommentList(e.pager.index)})).catch((function(){}))},loadFrames:function(){var t=this;_t.a.get(u["__imgPath"]+"data/user_avatar_frame.json").then((function(e){e.data&&(t.$store.state.frames=e.data)}))}},filters:{profileLink:function(t){return Object(r["authorLink"])(t)},showAvatar:function(t){return Object(r["showAvatar"])(t,48)}},created:function(){this.baseAPI="/api/comment/".concat(this.category,"/article/").concat(this.id)},mounted:function(){var t=this;xt().then((function(e){t.isDesc="desc"==e})).then((function(){t.reloadCommentList(1),t.loadFrames(),ut("".concat(t.baseAPI,"/i-am-author")).then((function(e){t.commentPower=e})).catch((function(){}))}))}},Ft=Lt,$t=(n("ae14"),Object(p["a"])(Ft,s,o,!1,null,null,null)),It=$t.exports;const Ut=Object.freeze({PRIVATE:0,PUBLIC:1,all(){return[this.PRIVATE,this.PUBLIC]}});var zt=Ut,Ot=n("c106"),Pt=n("6c2b"),St=n("cdd3"),jt=n("9616"),Et={name:"Detail",props:[],data:function(){return{publish:zt,collection:"",url:location.href,views:0,loading:!1}},computed:{edit_link:function(){return Object(r["editLink"])("collection",this.collection.id)},id:function(){return this.collection.id}},components:{Search:Ot["a"],"jx3-comment":It},methods:{date_format:St["a"],get_thumbnail:r["getThumbnail"],get_link:r["getLink"],get_type_label:r["getTypeLabel"],canEdit:function(){return this.collection.user_id==Ct["a"].getInfo().uid||Ct["a"].getInfo().group>60},delete_handle:function(t,e){var n=this;return t.preventDefault(),this.$confirm("确认是否删除该剑三小册？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(Pt["e"])(e).then((function(t){t=t.data,200===t.code?(n.$message.success(t.message),Object(Pt["d"])({limit:n.limit}),n.$router.push({name:"home"})):n.$message.error(t.message)}))})),!1}},filters:{authorLink:r["authorLink"]},mounted:function(){},watch:{"$route.params.collection_id":{immediate:!0,handler:function(){var t=this;this.$route.params.collection_id&&(this.loading=!0,Object(Pt["a"])(this.$route.params.collection_id,{post_extra:1}).then((function(e){e=e.data,200===e.code&&(t.collection=e.data.collection?e.data.collection:{})})).finally((function(){t.loading=!1})),Object(jt["c"])("collection",this.$route.params.collection_id),Object(jt["a"])("collection",this.$route.params.collection_id).then((function(e){t.views=e.data.views})))}}}},At=Et,Nt=(n("1829"),Object(p["a"])(At,a,i,!1,null,null,null));e["default"]=Nt.exports},d81d:function(t,e,n){"use strict";var a=n("23e7"),i=n("b727").map,s=n("1dde"),o=s("map");a({target:"Array",proto:!0,forced:!o},{map:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}})},e314:function(t,e,n){"use strict";n("f263")},e7d2:function(t,e,n){},eb09:function(t,e,n){},f263:function(t,e,n){}}]);
//# sourceMappingURL=chunk-0e802d5a.24ed6e59.js.map